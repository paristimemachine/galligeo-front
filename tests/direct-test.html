<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Galligeo - M√™me fen√™tre</title>
    <style>
        .test-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .test-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            min-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .test-result {
            margin: 5px 0;
            padding: 8px;
            border-radius: 5px;
            font-size: 0.9em;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        .btn {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-secondary { background-color: #6c757d; color: white; }
    </style>
</head>
<body>
    <div id="testOverlay" class="test-overlay">
        <div class="test-panel">
            <h2>üß™ Tests Galligeo</h2>
            <p><strong>Note:</strong> Cette page va charger l'application Galligeo et ex√©cuter les tests directement.</p>
            
            <div style="margin: 15px 0;">
                <button class="btn btn-primary" onclick="startTests()">üöÄ Lancer les tests</button>
                <button class="btn btn-secondary" onclick="closeTestPanel()">‚ùå Fermer</button>
                <button class="btn btn-success" onclick="window.location.reload()">üîÑ Recharger</button>
            </div>
            
            <div id="testResults"></div>
        </div>
    </div>

    <script>
        let testResults = [];

        function log(level, message) {
            const results = document.getElementById('testResults');
            const className = level === 'error' ? 'error' : level === 'success' ? 'success' : 'info';
            results.innerHTML += `<div class="test-result ${className}"><strong>[${level.toUpperCase()}]</strong> ${message}</div>`;
            results.scrollTop = results.scrollHeight;
        }

        function closeTestPanel() {
            document.getElementById('testOverlay').style.display = 'none';
        }

        function startTests() {
            log('info', 'üöÄ D√©marrage des tests...');
            
            // D'abord, tester la d√©tection d'√©l√©ments dans la page actuelle
            const selectors = {
                arkInput: '#search-784-input',
                loadButton: 'button[title="Ark : -> Gallica"]',
                georefButton: '#btn_georef',
                leftMap: '#map-left',
                rightMap: '#map-right',
                toggle: '#toggle'
            };

            log('info', 'üîç Test de d√©tection d\'√©l√©ments...');
            
            let found = 0;
            let total = Object.keys(selectors).length;

            Object.entries(selectors).forEach(([name, selector]) => {
                const element = document.querySelector(selector);
                if (element) {
                    log('success', `‚úÖ ${name}: ${selector} trouv√© (${element.tagName})`);
                    found++;
                } else {
                    log('error', `‚ùå ${name}: ${selector} non trouv√©`);
                }
            });

            log('info', `üìä D√©tection: ${found}/${total} √©l√©ments trouv√©s`);
            
            if (found === 0) {
                log('error', '‚ùå Aucun √©l√©ment trouv√© - L\'application ne semble pas √™tre charg√©e');
                log('info', 'üí° Suggestion: Rechargez et attendez que l\'application soit compl√®tement charg√©e');
            } else {
                log('success', 'üéâ Tests de d√©tection r√©ussis !');
                
                // Si les √©l√©ments sont trouv√©s, tester les objets JavaScript
                setTimeout(() => {
                    testJavaScriptObjects();
                }, 1000);
            }
        }

        function testJavaScriptObjects() {
            log('info', 'üîß Test des objets JavaScript...');
            
            // Test de Leaflet
            if (typeof window.L !== 'undefined') {
                log('success', '‚úÖ Leaflet (L) disponible');
            } else {
                log('error', '‚ùå Leaflet (L) non disponible');
            }
            
            // Test de PTMAuth
            if (typeof window.PTMAuth !== 'undefined') {
                log('success', '‚úÖ PTMAuth classe disponible');
            } else {
                log('error', '‚ùå PTMAuth classe non disponible');
            }
            
            // Test de l'instance auth
            if (typeof window.auth !== 'undefined') {
                log('success', '‚úÖ Instance auth disponible');
            } else {
                log('error', '‚ùå Instance auth non disponible');
            }
            
            // Test de settingsManager
            if (typeof window.settingsManager !== 'undefined') {
                log('success', '‚úÖ settingsManager disponible');
            } else {
                log('error', '‚ùå settingsManager non disponible');
            }
            
            log('info', 'üéØ Tests JavaScript termin√©s');
        }

        // Charger l'application Galligeo apr√®s un court d√©lai
        window.addEventListener('load', function() {
            // Attendre que le DOM soit pr√™t, puis charger l'application
            setTimeout(function() {
                log('info', 'üìã Chargement de l\'application Galligeo...');
                
                // Cr√©er un script pour charger l'application
                const script = document.createElement('script');
                script.onload = function() {
                    log('success', '‚úÖ Application charg√©e');
                };
                script.onerror = function() {
                    log('error', '‚ùå Erreur de chargement de l\'application');
                };
                
                // Au lieu de charger un script, rediriger vers l'application
                log('info', 'üîÑ Redirection vers l\'application...');
                setTimeout(() => {
                    window.location.href = '../index.html';
                }, 2000);
                
            }, 1000);
        });
    </script>
</body>
</html>
