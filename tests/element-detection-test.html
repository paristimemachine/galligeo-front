<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de DÃ©tection d'Ã‰lÃ©ments</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        .iframe-container { width: 100%; height: 400px; border: 2px solid #dee2e6; margin: 20px 0; }
        .iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>
    <h1>ğŸ” Test de DÃ©tection d'Ã‰lÃ©ments</h1>
    
    <button onclick="testElementDetection()">ğŸ§ª Tester la dÃ©tection</button>
    <button onclick="clearResults()">ğŸ—‘ï¸ Effacer</button>
    
    <div id="results"></div>
    
    <h3>Application Galligeo dans iframe :</h3>
    <div class="iframe-container">
        <iframe id="galligeoApp" src="../index.html?test=true&no_auth=true" class="iframe"></iframe>
    </div>

    <script>
        function log(level, message) {
            const results = document.getElementById('results');
            const className = level === 'error' ? 'error' : level === 'success' ? 'success' : 'info';
            results.innerHTML += `<div class="result ${className}"><strong>[${level.toUpperCase()}]</strong> ${message}</div>`;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function getTargetDocument() {
            // 1. Si on a un iframe dans le document actuel
            const iframe = document.getElementById('galligeoApp');
            if (iframe && iframe.contentDocument) {
                return iframe.contentDocument;
            }
            
            // 2. Utiliser le document actuel par defaut
            return document;
        }

        function querySelector(selector) {
            const targetDoc = getTargetDocument();
            const element = targetDoc.querySelector(selector);
            
            log('info', `Recherche de ${selector} dans ${targetDoc === document ? 'document actuel' : 'iframe'}`);
            
            if (element) {
                log('success', `âœ… Ã‰lÃ©ment trouvÃ©: ${selector} (${element.tagName})`);
            } else {
                log('error', `âŒ Ã‰lÃ©ment non trouvÃ©: ${selector}`);
            }
            
            return element;
        }

        function testElementDetection() {
            log('info', 'ğŸš€ DÃ©but du test de dÃ©tection d\'Ã©lÃ©ments');
            
            // Attendre un peu que l'iframe se charge
            setTimeout(() => {
                const selectors = {
                    arkInput: '#search-784-input',
                    loadButton: 'button[title="Ark : -> Gallica"]',
                    georefButton: '#btn_georef',
                    leftMap: '#map-left',
                    rightMap: '#map-right',
                    toggle: '#toggle'
                };

                let found = 0;
                let total = Object.keys(selectors).length;

                Object.entries(selectors).forEach(([name, selector]) => {
                    const element = querySelector(selector);
                    if (element) found++;
                });

                log('info', `ğŸ“Š RÃ©sultat: ${found}/${total} Ã©lÃ©ments trouvÃ©s`);
                
                // Test de l'Ã©tat de l'iframe
                const iframe = document.getElementById('galligeoApp');
                if (iframe) {
                    log('info', `ğŸ“± Ã‰tat iframe: ${iframe.contentDocument ? 'Document accessible' : 'Document non accessible'}`);
                    if (iframe.contentDocument) {
                        log('info', `ğŸ“„ Titre iframe: "${iframe.contentDocument.title}"`);
                        log('info', `ğŸ”— URL iframe: ${iframe.contentDocument.location.href}`);
                    }
                }
                
            }, 2000); // Attendre 2 secondes pour le chargement
        }

        // Auto-test au chargement
        window.addEventListener('load', () => {
            log('info', 'ğŸ“‹ Interface de test chargÃ©e');
            log('info', 'â³ Attendez 3 secondes puis cliquez sur "Tester la dÃ©tection"');
        });
    </script>
</body>
</html>
