<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Refresh G√©or√©f√©rencement et Contr√¥le d'Opacit√©</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #2196f3;
            border-bottom: 3px solid #2196f3;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #333;
            margin-top: 0;
        }
        
        .test-item {
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #ddd;
            background: #f9f9f9;
        }
        
        .test-item.success {
            border-left-color: #4caf50;
            background: #e8f5e9;
        }
        
        .test-item.warning {
            border-left-color: #ff9800;
            background: #fff3e0;
        }
        
        .test-item.error {
            border-left-color: #f44336;
            background: #ffebee;
        }
        
        .code {
            background: #263238;
            color: #aed581;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        
        button:hover {
            background: #1976d2;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .status.ok {
            background: #4caf50;
            color: white;
        }
        
        .status.ko {
            background: #f44336;
            color: white;
        }
        
        .status.pending {
            background: #ff9800;
            color: white;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .feature-list li:before {
            content: "‚úì ";
            color: #4caf50;
            font-weight: bold;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>üß™ Tests - Refresh G√©or√©f√©rencement et Contr√¥le d'Opacit√©</h1>
    
    <div class="test-section">
        <h2>üìã Checklist des fonctionnalit√©s</h2>
        <ul class="feature-list">
            <li>Variable globale <code>window.currentGeoreferencedLayer</code> cr√©√©e</li>
            <li>Suppression automatique de l'ancien layer avant d'ajouter le nouveau</li>
            <li>Timestamp ajout√© aux URLs des tuiles pour √©viter le cache</li>
            <li>Contr√¥le d'opacit√© cr√©√© et ajout√© √† la carte droite</li>
            <li>Contr√¥le d'opacit√© affich√©/masqu√© selon la pr√©sence d'un layer</li>
            <li>Contr√¥le d'opacit√© r√©initialis√© √† 100% lors d'un nouveau g√©or√©f√©rencement</li>
            <li>Styles CSS ajout√©s pour un design moderne</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>üîç Test 1 : V√©rification de la variable globale</h2>
        <div id="test1" class="test-item">
            <p><strong>Test :</strong> V√©rifier que <code>window.currentGeoreferencedLayer</code> existe</p>
            <button onclick="runTest1()">Ex√©cuter le test</button>
            <span id="test1-status"></span>
        </div>
        <div id="test1-result"></div>
    </div>
    
    <div class="test-section">
        <h2>üîç Test 2 : V√©rification du contr√¥le d'opacit√©</h2>
        <div id="test2" class="test-item">
            <p><strong>Test :</strong> V√©rifier que <code>window.opacityControl</code> existe</p>
            <button onclick="runTest2()">Ex√©cuter le test</button>
            <span id="test2-status"></span>
        </div>
        <div id="test2-result"></div>
    </div>
    
    <div class="test-section">
        <h2>üîç Test 3 : V√©rification des m√©thodes du contr√¥le</h2>
        <div id="test3" class="test-item">
            <p><strong>Test :</strong> V√©rifier que le contr√¥le a les m√©thodes <code>show()</code>, <code>hide()</code>, et <code>reset()</code></p>
            <button onclick="runTest3()">Ex√©cuter le test</button>
            <span id="test3-status"></span>
        </div>
        <div id="test3-result"></div>
    </div>
    
    <div class="test-section">
        <h2>üìù Instructions de test manuel</h2>
        <div class="test-item">
            <h3>Test du refresh du g√©or√©f√©rencement</h3>
            <ol>
                <li>Charger une carte Gallica dans l'interface</li>
                <li>Placer au moins 3 points de contr√¥le</li>
                <li>Cliquer sur "G√©or√©f√©rencer"</li>
                <li>Attendre que la carte g√©or√©f√©renc√©e apparaisse sur la carte droite</li>
                <li><strong>Modifier les points de contr√¥le</strong> (d√©placer ou supprimer/ajouter)</li>
                <li>Cliquer √† nouveau sur "G√©or√©f√©rencer"</li>
                <li><strong>‚úì V√©rifier que la nouvelle carte remplace l'ancienne sans doublon</strong></li>
            </ol>
        </div>
        
        <div class="test-item">
            <h3>Test du contr√¥le d'opacit√©</h3>
            <ol>
                <li>Apr√®s un g√©or√©f√©rencement r√©ussi</li>
                <li><strong>‚úì V√©rifier qu'un contr√¥le "Transparence de la carte" appara√Æt en haut √† droite</strong></li>
                <li>D√©placer le slider de transparence</li>
                <li><strong>‚úì V√©rifier que la transparence de la carte g√©or√©f√©renc√©e change en temps r√©el</strong></li>
                <li>Mettre le slider √† 0% (carte invisible)</li>
                <li>Mettre le slider √† 100% (carte opaque)</li>
                <li>Refaire un g√©or√©f√©rencement</li>
                <li><strong>‚úì V√©rifier que le slider revient √† 100%</strong></li>
            </ol>
        </div>
        
        <div class="test-item">
            <h3>Test de la gestion m√©moire</h3>
            <ol>
                <li>Ouvrir la console d√©veloppeur (F12)</li>
                <li>Faire plusieurs g√©or√©f√©rencements successifs</li>
                <li><strong>‚úì V√©rifier dans les logs qu'il y a des messages "üîÑ Suppression de l'ancien layer"</strong></li>
                <li><strong>‚úì V√©rifier qu'aucune erreur n'appara√Æt</strong></li>
            </ol>
        </div>
    </div>
    
    <div class="test-section">
        <h2>üêõ Probl√®mes potentiels √† surveiller</h2>
        <div class="test-item warning">
            <h3>‚ö†Ô∏è Cache du navigateur</h3>
            <p>Si les tuiles ne se rafra√Æchissent pas, v√©rifier que le timestamp est bien ajout√© aux URLs.</p>
            <div class="code">
                // Dans la console, v√©rifier l'URL des tuiles :
                URL devrait contenir : ?t=1234567890
            </div>
        </div>
        
        <div class="test-item warning">
            <h3>‚ö†Ô∏è Layers multiples</h3>
            <p>Si plusieurs couches s'empilent, v√©rifier que <code>window.currentGeoreferencedLayer</code> est bien mis √† jour.</p>
        </div>
        
        <div class="test-item warning">
            <h3>‚ö†Ô∏è Contr√¥le d'opacit√© non visible</h3>
            <p>V√©rifier que le fichier CSS <code>map.css</code> est bien charg√©.</p>
        </div>
    </div>
    
    <div class="test-section">
        <h2>‚úÖ Crit√®res de r√©ussite</h2>
        <div class="test-item success">
            <ul>
                <li><strong>Refresh fonctionnel</strong> : Un nouveau g√©or√©f√©rencement remplace l'ancien sans doublon</li>
                <li><strong>Cache invalid√©</strong> : Les nouvelles tuiles sont bien charg√©es (pas de cache)</li>
                <li><strong>Contr√¥le visible</strong> : Le contr√¥le d'opacit√© appara√Æt apr√®s le g√©or√©f√©rencement</li>
                <li><strong>Opacit√© r√©active</strong> : Le slider modifie la transparence en temps r√©el</li>
                <li><strong>Reset fonctionnel</strong> : Le slider revient √† 100% lors d'un nouveau g√©or√©f√©rencement</li>
                <li><strong>Pas d'erreur console</strong> : Aucune erreur JavaScript</li>
                <li><strong>Performance</strong> : Pas de ralentissement notable</li>
            </ul>
        </div>
    </div>
    
    <script>
        function runTest1() {
            const statusEl = document.getElementById('test1-status');
            const resultEl = document.getElementById('test1-result');
            
            if (typeof window.currentGeoreferencedLayer !== 'undefined') {
                statusEl.className = 'status ok';
                statusEl.textContent = 'OK';
                resultEl.innerHTML = '<div class="test-item success"><strong>‚úì SUCC√àS</strong><br>La variable <code>window.currentGeoreferencedLayer</code> existe.<div class="code">Type: ' + typeof window.currentGeoreferencedLayer + '<br>Valeur: ' + window.currentGeoreferencedLayer + '</div></div>';
            } else {
                statusEl.className = 'status ko';
                statusEl.textContent = 'KO';
                resultEl.innerHTML = '<div class="test-item error"><strong>‚úó √âCHEC</strong><br>La variable <code>window.currentGeoreferencedLayer</code> n\'existe pas.<br><em>V√©rifier que init.js est charg√©.</em></div>';
            }
        }
        
        function runTest2() {
            const statusEl = document.getElementById('test2-status');
            const resultEl = document.getElementById('test2-result');
            
            if (typeof window.opacityControl !== 'undefined') {
                statusEl.className = 'status ok';
                statusEl.textContent = 'OK';
                resultEl.innerHTML = '<div class="test-item success"><strong>‚úì SUCC√àS</strong><br>La variable <code>window.opacityControl</code> existe.<div class="code">Type: ' + typeof window.opacityControl + '</div></div>';
            } else {
                statusEl.className = 'status ko';
                statusEl.textContent = 'KO';
                resultEl.innerHTML = '<div class="test-item error"><strong>‚úó √âCHEC</strong><br>La variable <code>window.opacityControl</code> n\'existe pas.<br><em>V√©rifier que map_interactions.js est charg√© et que les cartes sont initialis√©es.</em></div>';
            }
        }
        
        function runTest3() {
            const statusEl = document.getElementById('test3-status');
            const resultEl = document.getElementById('test3-result');
            
            if (typeof window.opacityControl === 'undefined') {
                statusEl.className = 'status ko';
                statusEl.textContent = 'KO';
                resultEl.innerHTML = '<div class="test-item error"><strong>‚úó √âCHEC</strong><br>Le contr√¥le n\'existe pas. Ex√©cuter d\'abord le Test 2.</div>';
                return;
            }
            
            const hasShow = typeof window.opacityControl.show === 'function';
            const hasHide = typeof window.opacityControl.hide === 'function';
            const hasReset = typeof window.opacityControl.reset === 'function';
            
            if (hasShow && hasHide && hasReset) {
                statusEl.className = 'status ok';
                statusEl.textContent = 'OK';
                resultEl.innerHTML = '<div class="test-item success"><strong>‚úì SUCC√àS</strong><br>Toutes les m√©thodes existent.<ul><li>show(): ' + hasShow + '</li><li>hide(): ' + hasHide + '</li><li>reset(): ' + hasReset + '</li></ul></div>';
            } else {
                statusEl.className = 'status ko';
                statusEl.textContent = 'KO';
                resultEl.innerHTML = '<div class="test-item error"><strong>‚úó √âCHEC</strong><br>Certaines m√©thodes sont manquantes.<ul><li>show(): ' + hasShow + '</li><li>hide(): ' + hasHide + '</li><li>reset(): ' + hasReset + '</li></ul></div>';
            }
        }
        
        // Auto-ex√©cution des tests au chargement
        window.addEventListener('load', function() {
            console.log('üß™ Page de test charg√©e');
            console.log('üìã Pour tester, visitez l\'application principale et revenez sur cette page');
        });
    </script>
</body>
</html>
