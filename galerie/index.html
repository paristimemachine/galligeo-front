<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="../node_modules/@gouvfr/dsfr/dist/dsfr.min.css">
    <link rel="stylesheet" href="../node_modules/@gouvfr/dsfr/dist/component/form/form.min.css">
    <link rel="stylesheet" href="../node_modules/@gouvfr/dsfr/dist/component/table/table.min.css">
    <link rel="stylesheet" href="../node_modules/@gouvfr/dsfr/dist/component/segmented/segmented.min.css">
    <link href="../node_modules/@gouvfr/dsfr/dist/core/core.min.css" rel="stylesheet">
    <link href="../node_modules/@gouvfr/dsfr/dist/component/link/link.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../node_modules/@gouvfr/dsfr/dist/utility/icons/icons.min.css">

    <meta name="theme-color" content="#000091">

    <!-- Favicon -->
    <link rel="apple-touch-icon" href="../img/favicon.png">
    <link rel="icon" href="../img/favicon.png" type="image/png">
    <title>Cartes g√©or√©f√©renc√©es - Galligeo</title>

    <!-- CSS interne -->
    <link rel="stylesheet" href="../css/main.css"/>

    <style>
        /* Layout avec header et footer fixes */
        html {
            height: 100%;
        }
        
        body {
            margin: 0;
            height: 100vh;
            overflow: hidden; /* Pas de scroll sur le body */
            display: flex;
            flex-direction: column;
        }
        
        /* Header fixe */
        .fr-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Barre de s√©lection sticky sous le header */
        .selection-toolbar {
            position: fixed;
            top: 80px; /* Hauteur approximative du header */
            left: 0;
            right: 0;
            background: #000091;
            color: white;
            padding: 1rem 0;
            z-index: 999;
            border-bottom: 2px solid #e5e5e5;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Zone de contenu scrollable */
        .main-content-wrapper {
            flex: 1;
            overflow-y: auto;
            padding-top: 80px; /* Espace pour le header fixe */
            padding-bottom: 120px; /* Espace pour le footer fixe */
        }
        
        /* Ajustement quand la barre de s√©lection est visible */
        .main-content-wrapper.with-selection-toolbar {
            padding-top: 140px; /* Header + barre de s√©lection */
        }
        
        /* Scrollbar personnalis√©e */
        .main-content-wrapper::-webkit-scrollbar {
            width: 8px;
        }
        
        .main-content-wrapper::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .main-content-wrapper::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        .main-content-wrapper::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Syst√®me de s√©lection */
        .selection-bar {
            background: #f6f6f6;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
            display: none; /* Masqu√© par d√©faut */
        }

        .selection-bar.active {
            display: block;
        }

        .selection-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .selection-count {
            font-weight: bold;
            color: #000091;
        }

        .selection-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .atlas-button {
            background: #000091;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }

        .atlas-button:hover:not(:disabled) {
            background: #1212ff;
        }

        .atlas-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Cartes s√©lectionnables */
        .map-card {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .map-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .map-card.selected {
            border: 2px solid #000091;
            box-shadow: 0 0 0 2px rgba(0, 0, 145, 0.2);
        }

        .map-card .selection-checkbox {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 2;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 4px;
            padding: 4px;
        }

        /* Lignes de tableau s√©lectionnables */
        .table-row {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .table-row:hover {
            background-color: rgba(0, 0, 145, 0.1);
        }

        .table-row.selected {
            background-color: rgba(0, 0, 145, 0.2);
        }
        
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            padding: 2rem 0;
            background: #f6f6f6;
            text-align: center;
            z-index: 998;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
        }
        
        .search-container {
            margin-bottom: 2rem;
        }
        
        .view-toggle-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .cards-container {
            padding-right: 10px; /* Espace pour √©viter le d√©bordement */
            padding: 1rem;
        }
        
        .cards-container.hidden {
            display: none !important;
        }
        
        .table-container {
            padding: 1rem;
        }
        
        .table-container.hidden {
            display: none !important;
        }
        
        /* Style de la scrollbar principale */
        body::-webkit-scrollbar {
            width: 10px;
        }
        
        body::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        body::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 5px;
        }
        
        body::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        
        .card-image {
            height: 200px;
            object-fit: cover;
        }
        
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
        }
        
        .error-message {
            text-align: center;
            padding: 2rem;
        }
        
        .pagination-container {
            margin-top: 2rem;
            text-align: center;
        }
        
        .stats-container {
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f6f6f6;
            border-radius: 4px;
        }
        
        .filter-container {
            margin-bottom: 2rem;
        }
        
        .footer-logo {
            margin: 0 0.5rem;
        }
        
        .heart-icon {
            width: 16px;
            height: 16px;
            color: #e74c3c;
        }
        
        .version-info {
            font-size: 0.85em;
            color: #666;
        }
        
        /* Syst√®me de s√©lection */
        .selection-toolbar {
            position: sticky;
            top: 0;
            background: #000091;
            color: white;
            padding: 1rem 0;
            z-index: 1000;
            border-bottom: 2px solid #e5e5e5;
        }
        
        .toolbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .selection-count {
            font-weight: bold;
        }
        
        .toolbar-actions {
            display: flex;
            gap: 1rem;
        }
        
        .selectable-card {
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .selectable-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .selectable-card.selected {
            border: 3px solid #000091;
            background: #f5f5fe;
        }
        
        .selectable-card.selected::after {
            content: "‚úì";
            position: absolute;
            top: 10px;
            right: 10px;
            background: #000091;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .selectable-item.selected {
            background: #f5f5fe;
        }
    </style>
  </head>
  <body>

    <!--  -->
    <!-- HEADER -->
    <!--  -->
    <header role="banner" class="fr-header">
        <div class="fr-header__body">
            <div class="fr-container--fluid">
                <div class="fr-header__body-row">
                    <div class="fr-header__brand fr-enlarge-link" style="margin-left: 24px;">
                        <div class="fr-header__brand-top">
                            <div class="fr-header__logo">
                            </div>
                            <div class="fr-header__operator">
                                <a href="../index.html" title="Retour √† l'accueil - Galligeo">
                                    <img class="fr-responsive-img" style="width:auto; height:70px; margin-left: -32px;" src="../img/logo_galligeo.png" alt="Galligeo" >
                                </a>
                            </div>
                            <div class="fr-header__navbar">
                                <button class="fr-btn--search fr-btn" data-fr-opened="false" aria-controls="modal-575" id="button-576" title="Rechercher">
                                    Rechercher
                                </button>
                                <button class="fr-btn--menu fr-btn" data-fr-opened="false" aria-controls="modal-577" aria-haspopup="menu" id="button-578" title="Menu">
                                    Menu
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="fr-header__tools">
                        <div class="fr-header__tools-links">
                            <ul class="fr-btns-group">
                                <li>
                                    <a class="fr-btn fr-icon-home-4-line" href="../index.html" style="color:#000091;">
                                        Accueil
                                    </a>
                                </li>
                                <li id="auth-button-container">
                                    <button class="fr-btn fr-icon-lock-line" href="#" style="color:#ff5555;" onclick="window.location.href='https://api.ptm.huma-num.fr/auth/login?redirect_url=https://app.ptm.huma-num.fr/galligeo/galerie/'">
                                        Se connecter avec ORCID
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="fr-header__menu fr-modal" id="modal-560" aria-labelledby="button-561" style="display:none;visibility: hidden;">
            <div class="fr-container">
                <button class="fr-btn--close fr-btn" aria-controls="modal-560" title="Fermer">
                    Fermer
                </button>
                <div class="fr-header__menu-links">
                </div>
                <nav class="fr-nav" id="navigation-564" role="navigation" aria-label="Menu principal">
                    <ul class="fr-nav__list">
                        <li class="fr-nav__item">
                            <a class="fr-nav__link" href="../index.html" target="_self">Galligeo</a>
                        </li>
                        <li class="fr-nav__item">
                            <a class="fr-nav__link" href="../cartes-georeferencees.html" target="_self">Cartes g√©or√©f√©renc√©es</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Barre de s√©lection sticky -->
    <div id="selection-toolbar" class="selection-toolbar" style="display: none;">
        <div class="fr-container">
            <div class="toolbar-content">
                <span class="selection-count">
                    <span id="selected-count">0</span> carte(s) s√©lectionn√©e(s)
                </span>
                <div class="toolbar-actions">
                    <button class="fr-btn fr-btn--sm fr-btn--secondary" onclick="clearSelection()">
                        Tout d√©s√©lectionner
                    </button>
                    <button class="fr-btn fr-btn--sm" onclick="createAtlas()">
                        <span class="fr-icon-map-2-line fr-mr-1w" aria-hidden="true"></span>
                        Cr√©er un atlas
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Zone de contenu scrollable englobante -->
    <div class="main-content-wrapper" id="mainContentWrapper">
        <!-- Container principal pour le contenu -->
        <div class="fr-container fr-py-4w main-content">

            <!-- Titre de la page -->
            <div class="fr-grid-row fr-grid-row--center">
                <div class="fr-col-12">
                    <h1 class="fr-h1 fr-mb-4w">
                        <span class="fr-icon-map-2-fill fr-mr-2w" aria-hidden="true"></span>
                        Cartes g√©or√©f√©renc√©es par la communaut√©
                    </h1>
                    
                    <p class="fr-text--lg fr-mb-4w">
                        D√©couvrez les cartes historiques g√©or√©f√©renc√©es par les utilisateurs de Galligeo. 
                        Ces cartes proviennent des collections de <a href="https://gallica.bnf.fr" target="_blank" rel="noopener">Gallica (BnF)</a> 
                        et ont √©t√© g√©olocalis√©es avec pr√©cision par notre communaut√©.
                    </p>
                </div>
            </div>

        <!-- Statistiques -->
        <div class="fr-grid-row fr-grid-row--center fr-mb-4w">
            <div class="fr-col-12">
                <div class="stats-container">
                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-md-4 fr-col-12">
                            <div class="fr-card fr-card--no-border">
                                <div class="fr-card__body">
                                    <div class="fr-card__content">
                                        <h3 class="fr-card__title" id="total-count">
                                            <span class="fr-icon-loader-line" aria-hidden="true"></span>
                                            Chargement...
                                        </h3>
                                        <p class="fr-card__desc">Cartes g√©or√©f√©renc√©es</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="fr-col-md-4 fr-col-12">
                            <div class="fr-card fr-card--no-border">
                                <div class="fr-card__body">
                                    <div class="fr-card__content">
                                        <h3 class="fr-card__title" id="contributors-count">
                                            <span class="fr-icon-loader-line" aria-hidden="true"></span>
                                            Chargement...
                                        </h3>
                                        <p class="fr-card__desc">Contributeurs</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="fr-col-md-4 fr-col-12">
                            <div class="fr-card fr-card--no-border">
                                <div class="fr-card__body">
                                    <div class="fr-card__content">
                                        <h3 class="fr-card__title" id="recent-count">
                                            <span class="fr-icon-loader-line" aria-hidden="true"></span>
                                            Chargement...
                                        </h3>
                                        <p class="fr-card__desc">Ce mois-ci</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Barre de recherche -->
        <div class="fr-grid-row fr-grid-row--center">
            <div class="fr-col-12 fr-col-lg-8">
                <div class="search-container">
                    <div class="fr-search-bar" id="search-bar">
                        <label class="fr-label" for="search-input">
                            Rechercher dans les cartes g√©or√©f√©renc√©es
                        </label>
                        <input class="fr-input" 
                               placeholder="Entrez un titre, lieu, cr√©ateur, date..." 
                               type="search" 
                               id="search-input" 
                               name="search-input">
                        <button class="fr-btn" title="Rechercher" id="search-button">
                            Rechercher
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Zone de s√©lection et cr√©ation d'atlas -->
        <div class="fr-grid-row fr-grid-row--center">
            <div class="fr-col-12">
                <div class="selection-bar" id="selection-bar">
                    <div class="selection-info">
                        <div>
                            <span class="selection-count" id="selection-count">0 carte(s) s√©lectionn√©e(s)</span>
                            <span class="fr-text--sm fr-ml-2w">S√©lectionnez au moins 2 cartes pour cr√©er un atlas</span>
                        </div>
                        <div class="selection-actions">
                            <button type="button" class="fr-btn fr-btn--secondary fr-btn--sm" onclick="clearAllSelections()">
                                <span class="fr-icon-close-line fr-mr-1w" aria-hidden="true"></span>
                                Tout d√©s√©lectionner
                            </button>
                            <button type="button" class="atlas-button" id="atlas-button" onclick="createAtlas()" disabled>
                                <span class="fr-icon-map-2-line fr-mr-1w" aria-hidden="true"></span>
                                Cr√©er un atlas
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filtres et options d'affichage -->
        <div class="fr-grid-row fr-grid-row--center">
            <div class="fr-col-12">
                <div class="view-toggle-container">
                    <div class="filter-container">
                        <fieldset class="fr-fieldset fr-fieldset--inline">
                            <legend class="fr-fieldset__legend">
                                Filtrer par p√©riode :
                            </legend>
                            <div class="fr-fieldset__content">
                                <div class="fr-select-group">
                                    <label class="fr-label" for="period-filter">P√©riode</label>
                                    <select class="fr-select" id="period-filter" name="period-filter">
                                        <option value="">Toutes les p√©riodes</option>
                                        <option value="moyen-age">Moyen √Çge</option>
                                        <option value="renaissance">Renaissance (XVe-XVIe s.)</option>
                                        <option value="moderne">√âpoque moderne (XVIIe-XVIIIe s.)</option>
                                        <option value="19e">XIXe si√®cle</option>
                                        <option value="20e">XXe si√®cle</option>
                                    </select>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    
                    <div class="view-toggle">
                        <fieldset class="fr-segmented fr-segmented--no-legend">
                            <legend class="fr-segmented__legend fr-segmented__legend--inline">
                                Affichage
                            </legend>
                            <div class="fr-segmented__elements">
                                <div class="fr-segmented__element">
                                    <input value="cards" checked type="radio" id="view-cards" name="view-mode">
                                    <label class="fr-label" for="view-cards">
                                        <span class="fr-icon-grid-fill" aria-hidden="true"></span>
                                        Cartes
                                    </label>
                                </div>
                                <div class="fr-segmented__element">
                                    <input value="table" type="radio" id="view-table" name="view-mode">
                                    <label class="fr-label" for="view-table">
                                        <span class="fr-icon-table-line" aria-hidden="true"></span>
                                        Tableau
                                    </label>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <!-- R√©sultats -->
        <div class="fr-grid-row fr-grid-row--center">
            <div class="fr-col-12">
                
                <!-- Affichage en cartes -->
                <div id="cards-container" class="cards-container">
                    <div class="fr-grid-row fr-grid-row--gutters" id="cards-grid">
                        <!-- Loading initial -->
                        <div class="fr-col-12">
                            <div class="loading-spinner">
                                <div class="fr-card fr-card--no-border">
                                    <div class="fr-card__body">
                                        <div class="fr-card__content">
                                            <p class="fr-text--lg">
                                                <span class="fr-icon-loader-line fr-mr-2w" aria-hidden="true"></span>
                                                Chargement des cartes g√©or√©f√©renc√©es...
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Affichage en tableau -->
                <div id="table-container" class="table-container hidden">
                    <div class="fr-table fr-table--lg">
                        <table id="maps-table">
                            <caption>Liste des cartes g√©or√©f√©renc√©es</caption>
                            <thead>
                                <tr>
                                    <th scope="col">
                                        <input type="checkbox" id="select-all" class="fr-checkbox-input" onchange="toggleSelectAll(this)">
                                        <label for="select-all" class="fr-checkbox-label">Titre</label>
                                    </th>
                                    <th scope="col">Attribution</th>
                                    <th scope="col">Identifiant</th>
                                    <th scope="col">G√©or√©f√©renc√© par</th>
                                    <th scope="col">G√©or√©f√©renc√© le</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="table-body">
                                <!-- Le contenu sera g√©n√©r√© dynamiquement -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination-container">
                    <nav role="navigation" class="fr-pagination" aria-label="Pagination navigation" id="pagination-nav" style="display: none;">
                        <ul class="fr-pagination__list">
                            <!-- La pagination sera g√©n√©r√©e dynamiquement -->
                        </ul>
                    </nav>
                </div>

            </div>
        </div>

    </div>
    <!-- END Container principal -->
    
    </div>
    <!-- END Zone de contenu scrollable -->

    <!--  -->
    <!-- FOOTER -->
    <!--  -->
    <footer class="footer">
        <p>Made with
            <svg class="heart-icon" aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <path fill="currentColor" d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z">
                </path>
            </svg>
            &nbsp by <img class="fr-responsive-img footer-logo" style="width:auto; height:28px; cursor: pointer;" src="../img/logo_ptm_small.png" alt="PTM" onclick="openExternalLink('https://ptm.huma-num.fr/')" title="Projets Time Machine">
            
           <img class="fr-responsive-img footer-logo" style="width:auto; height:16px; cursor: pointer;" src="../img/logo_hn.png" alt="Huma-Num" onclick="openExternalLink('https://www.huma-num.fr/')" title="Huma-Num">
           &nbsp;+&nbsp;
           <img class="fr-responsive-img footer-logo" style="width:auto; height:16px; cursor: pointer;" src="../img/logo_bnf_datalab.png" alt="BnF / Datalab" onclick="openExternalLink('https://www.bnf.fr/fr/bnf-datalab')" title="BnF / Datalab">
           &nbsp;‚Äî&nbsp;
           <span style="cursor: pointer; text-decoration: underline;" onclick="openExternalLink('https://github.com/paristimemachine/galligeo-front')" title="Code & Documentation">Code &amp; Documentation</span>
           &nbsp;‚Äî
           <span id="app-version-info" class="version-info" style="opacity: 0.7; font-size: 0.85em; color: #666;">
               <span id="version-display">Chargement...</span>
           </span>
        </p>
    </footer>
    <!--  -->
    <!-- END FOOTER -->
    <!--  -->

    <!-- Scripts DSFR -->
    <script type="module" src="../node_modules/@gouvfr/dsfr/dist/dsfr.module.min.js"></script>
    <script type="text/javascript" nomodule src="../node_modules/@gouvfr/dsfr/dist/dsfr.nomodule.min.js"></script>
    <script type="module" src="../node_modules/@gouvfr/dsfr/dist/core/core.module.min.js"></script>

    <!-- Scripts de l'application -->
    <script src="../js/version.js"></script>
    <script src="../js/ptm-auth.js"></script>
    <script src="../js/cartes-georeferencees.js"></script>

    <script>
        function openExternalLink(url) {
            window.open(url, '_blank', 'noopener,noreferrer');
        }

        // Variables globales pour la s√©lection
        let selectedMaps = new Set();

        // Fonctions de s√©lection
        function toggleMapSelection(arkId, element) {
            if (selectedMaps.has(arkId)) {
                selectedMaps.delete(arkId);
                element.classList.remove('selected');
            } else {
                selectedMaps.add(arkId);
                element.classList.add('selected');
            }
            updateSelectionUI();
        }

        function toggleSelectAll(checkbox) {
            const allCheckboxes = document.querySelectorAll('.selectable-item input[type="checkbox"]');
            const allCards = document.querySelectorAll('.selectable-card');
            
            if (checkbox.checked) {
                // S√©lectionner tout
                allCheckboxes.forEach(cb => {
                    cb.checked = true;
                    const arkId = cb.dataset.arkId;
                    if (arkId) selectedMaps.add(arkId);
                });
                allCards.forEach(card => {
                    const arkId = card.dataset.arkId;
                    if (arkId) {
                        selectedMaps.add(arkId);
                        card.classList.add('selected');
                    }
                });
            } else {
                // D√©s√©lectionner tout
                clearSelection();
            }
            updateSelectionUI();
        }

        function clearSelection() {
            selectedMaps.clear();
            document.querySelectorAll('.selectable-item input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('.selectable-card.selected').forEach(card => card.classList.remove('selected'));
            document.getElementById('select-all').checked = false;
            updateSelectionUI();
        }

        function updateSelectionUI() {
            const count = selectedMaps.size;
            const toolbar = document.getElementById('selection-toolbar');
            const countElement = document.getElementById('selected-count');
            const mainWrapper = document.getElementById('mainContentWrapper');
            
            if (count > 0) {
                toolbar.style.display = 'block';
                countElement.textContent = count;
                mainWrapper.classList.add('with-selection-toolbar');
            } else {
                toolbar.style.display = 'none';
                mainWrapper.classList.remove('with-selection-toolbar');
            }
        }

        function createAtlas() {
            if (selectedMaps.size === 0) {
                alert('Veuillez s√©lectionner au moins une carte.');
                return;
            }
            
            const selectedArray = Array.from(selectedMaps);
            console.log('Cr√©ation d\'un atlas avec les cartes:', selectedArray);
            
            // TODO: Impl√©menter la cr√©ation d'atlas
            alert(`Atlas cr√©√© avec ${selectedArray.length} carte(s). Cette fonctionnalit√© sera bient√¥t disponible !`);
        }

        // Initialisation de la page
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('Initialisation de la page des cartes g√©or√©f√©renc√©es');
            
            // V√©rifier l'authentification au chargement
            await checkAuthenticationStatus();
            
            // Charger le contenu r√©el depuis l'API
            await loadRealContent();
            
            // Attendre que le contenu soit bien ins√©r√©, puis initialiser les vues
            setTimeout(() => {
                // Initialiser le basculement de vue
                initializeViewToggle();
                
                // Initialiser la recherche et le filtrage
                initializeSearchAndFilter();
                console.log('üîß initializeSearchAndFilter() appel√©e');
                
                // S'assurer que la vue cartes est visible par d√©faut
                const cardsContainer = document.getElementById('cards-container');
                const tableContainer = document.getElementById('table-container');
                if (cardsContainer && tableContainer) {
                    cardsContainer.classList.remove('hidden');
                    tableContainer.classList.add('hidden');
                    
                    // V√©rifier que le contenu est bien pr√©sent
                    const cardsContent = cardsContainer.innerHTML;
                    const tableContent = tableContainer.querySelector('tbody')?.innerHTML;
                    console.log('Initialisation finale - Cards:', cardsContent.length > 100 ? 'OK' : 'VIDE');
                    console.log('Initialisation finale - Table:', tableContent?.length > 100 ? 'OK' : 'VIDE');
                }
            }, 1000);
            
            // Initialiser l'affichage de version
            initializeVersionDisplay();
        });

        // === SYST√àME DE S√âLECTION ===
        
        // Fonction pour basculer la s√©lection d'une carte
        function toggleMapSelection(arkId, element) {
            if (selectedMaps.has(arkId)) {
                selectedMaps.delete(arkId);
                element.classList.remove('selected');
                // D√©cocher la checkbox correspondante si elle existe
                const checkbox = document.querySelector(`input[data-ark-id="${arkId}"]`);
                if (checkbox) checkbox.checked = false;
            } else {
                selectedMaps.add(arkId);
                element.classList.add('selected');
                // Cocher la checkbox correspondante si elle existe
                const checkbox = document.querySelector(`input[data-ark-id="${arkId}"]`);
                if (checkbox) checkbox.checked = true;
            }
            updateSelectionUI();
        }

        // Fonction pour tout s√©lectionner/d√©s√©lectionner (checkbox "select-all")
        function toggleSelectAll(selectAllCheckbox) {
            const allCheckboxes = document.querySelectorAll('input[data-ark-id]');
            const allCards = document.querySelectorAll('[data-ark-id].map-card');
            const allRows = document.querySelectorAll('[data-ark-id].table-row');
            
            if (selectAllCheckbox.checked) {
                // S√©lectionner tout
                allCheckboxes.forEach(cb => {
                    cb.checked = true;
                    const arkId = cb.dataset.arkId;
                    if (arkId) selectedMaps.add(arkId);
                });
                allCards.forEach(card => {
                    const arkId = card.dataset.arkId;
                    if (arkId) {
                        selectedMaps.add(arkId);
                        card.classList.add('selected');
                    }
                });
                allRows.forEach(row => {
                    const arkId = row.dataset.arkId;
                    if (arkId) {
                        selectedMaps.add(arkId);
                        row.classList.add('selected');
                    }
                });
            } else {
                // D√©s√©lectionner tout
                clearAllSelections();
            }
            updateSelectionUI();
        }

        function clearAllSelections() {
            selectedMaps.clear();
            // D√©cocher toutes les checkboxes
            document.querySelectorAll('input[data-ark-id]').forEach(cb => cb.checked = false);
            document.getElementById('select-all').checked = false;
            // Retirer la classe selected de tous les √©l√©ments
            document.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
            updateSelectionUI();
        }

        function updateSelectionUI() {
            const count = selectedMaps.size;
            const selectionBar = document.getElementById('selection-bar');
            const selectionCount = document.getElementById('selection-count');
            const atlasButton = document.getElementById('atlas-button');
            
            // Mettre √† jour le texte de comptage
            selectionCount.textContent = `${count} carte(s) s√©lectionn√©e(s)`;
            
            // Afficher/masquer la barre de s√©lection
            if (count > 0) {
                selectionBar.classList.add('active');
            } else {
                selectionBar.classList.remove('active');
            }
            
            // Activer/d√©sactiver le bouton atlas (minimum 2 cartes)
            if (count >= 2) {
                atlasButton.disabled = false;
                atlasButton.textContent = 'Cr√©er un atlas';
            } else {
                atlasButton.disabled = true;
                atlasButton.textContent = count === 0 ? 'Cr√©er un atlas' : 'S√©lectionnez au moins 2 cartes';
            }
        }

        function createAtlas() {
            if (selectedMaps.size < 2) {
                alert('Veuillez s√©lectionner au moins 2 cartes pour cr√©er un atlas.');
                return;
            }
            
            const selectedArray = Array.from(selectedMaps);
            console.log('Cr√©ation d\'un atlas avec les cartes:', selectedArray);
            
            // R√©cup√©rer les donn√©es des cartes s√©lectionn√©es
            const selectedMapsData = realMapsData.filter(map => selectedArray.includes(map.ark));
            
            console.log('Donn√©es des cartes s√©lectionn√©es:', selectedMapsData);
            
            // TODO: Impl√©menter la logique de cr√©ation d'atlas
            const mapsList = selectedMapsData.map(map => 
                `‚Ä¢ ${map.ark} (g√©or√©f√©renc√© par ${map.georeferenced_by})`
            ).join('\n');
            
            alert(`Atlas √† cr√©er avec ${selectedArray.length} cartes :\n\n${mapsList}\n\nFonctionnalit√© en cours de d√©veloppement...`);
        }

        // Gestionnaire pour les clics sur les cartes
        function handleCardClick(event, arkId) {
            // √âviter le comportement par d√©faut si c'est une checkbox
            if (event.target.type === 'checkbox') {
                const card = event.target.closest('.map-card');
                if (card) {
                    toggleMapSelection(arkId, card);
                }
                return;
            }
            
            // Clic sur la carte elle-m√™me
            const card = event.currentTarget;
            toggleMapSelection(arkId, card);
        }

        // Gestionnaire pour les clics sur les lignes du tableau
        function handleRowClick(event, arkId) {
            // √âviter le comportement par d√©faut si c'est une checkbox
            if (event.target.type === 'checkbox') {
                const row = event.target.closest('.table-row');
                if (row) {
                    toggleMapSelection(arkId, row);
                }
                return;
            }
            
            // Clic sur la ligne elle-m√™me
            const row = event.currentTarget;
            toggleMapSelection(arkId, row);
        }

        // === FIN SYST√àME DE S√âLECTION ===

        // === G√âN√âRATION DE CONTENU R√âEL ===
        
        // Variable pour stocker les donn√©es de l'API
        let realMapsData = [];
        
        // Fonction pour r√©cup√©rer les cartes g√©or√©f√©renc√©es depuis l'API PTM
        async function fetchGeoreferencedMaps() {
            try {
                console.log('R√©cup√©ration des cartes g√©or√©f√©renc√©es...');
                const response = await fetch('https://api.ptm.huma-num.fr/auth/admin/galligeo/georeferenced-maps-by-users');
                
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Donn√©es re√ßues de l\'API:', data);
                
                if (data.status === 'ok' && data.users) {
                    // Transformer les donn√©es pour notre format
                    realMapsData = [];
                    
                    data.users.forEach(user => {
                        user.georeferenced_maps.forEach(map => {
                            realMapsData.push({
                                ark: map.ark,
                                status: map.status,
                                firstWorked: map.firstWorked,
                                lastUpdated: map.lastUpdated,
                                georeferenced_by: user.full_name || `${user.first_name || ''} ${user.last_name || ''}`.trim() || 'Utilisateur anonyme',
                                georeferenced_date: map.lastUpdated,
                                orcid_id: user.orcid_id
                            });
                        });
                    });
                    
                    console.log('Cartes transform√©es:', realMapsData.length);
                    return { success: true, data: realMapsData, stats: data };
                } else {
                    throw new Error('Format de donn√©es invalide');
                }
                
            } catch (error) {
                console.error('Erreur lors de la r√©cup√©ration des cartes g√©or√©f√©renc√©es:', error);
                return { success: false, error: error.message };
            }
        }
        
        // Fonction pour g√©n√©rer l'URL de la vignette Gallica IIIF
        function generateGallicaThumbnail(arkId) {
            return `https://gallica.bnf.fr/iiif/ark:/12148/${arkId}/f1/full/300,/0/native.jpg`;
        }
        
        // Fonction pour g√©n√©rer l'URL Gallica (fallback si pas dans manifest)
        function generateGallicaUrl(arkId) {
            return `https://gallica.bnf.fr/ark:/12148/${arkId}`;
        }
        
        // Fonction pour g√©n√©rer l'URL de g√©or√©f√©rencement
        function generateGeoreferenceUrl(arkId) {
            return `https://app.ptm.huma-num.fr/galligeo/georef/?ark=${arkId}`;
        }
        
        // Fonction pour r√©cup√©rer les m√©tadonn√©es Gallica via l'API IIIF Manifest
        async function fetchGallicaMetadata(arkId) {
            try {
                const manifestUrl = `https://gallica.bnf.fr/iiif/ark:/12148/${arkId}/manifest.json`;
                console.log(`R√©cup√©ration des m√©tadonn√©es pour ${arkId}...`);
                
                const response = await fetch(manifestUrl);
                
                if (!response.ok) {
                    throw new Error(`Erreur Gallica Manifest: ${response.status}`);
                }
                
                const manifest = await response.json();
                console.log(`Manifest r√©cup√©r√© pour ${arkId}:`, manifest);
                
                // Extraction des m√©tadonn√©es du manifest IIIF
                const title = manifest.description || manifest.label || 'Titre non disponible';
                const gallicaUrl = manifest.related || `https://gallica.bnf.fr/ark:/12148/${arkId}`;
                const attribution = manifest.attribution || '';
                
                // Rechercher la date dans les m√©tadonn√©es avec logs d√©taill√©s
                let date = '';
                console.log(`M√©tadonn√©es disponibles pour ${arkId}:`, manifest.metadata);
                
                if (manifest.metadata && Array.isArray(manifest.metadata)) {
                    console.log(`Recherche de date dans ${manifest.metadata.length} √©l√©ments de m√©tadonn√©es`);
                    
                    manifest.metadata.forEach((item, index) => {
                        console.log(`M√©tadonn√©e ${index}:`, item);
                        if (item.label && item.label.toLowerCase().includes('date')) {
                            console.log(`Date trouv√©e dans m√©tadonn√©e ${index}:`, item.value);
                            date = item.value;
                        }
                    });
                    
                    if (!date) {
                        console.log(`Aucune date trouv√©e dans les m√©tadonn√©es pour ${arkId}`);
                        // Essayer d'autres champs
                        const altDateFields = ['created', 'issued', 'published', 'navDate'];
                        for (const field of altDateFields) {
                            if (manifest[field]) {
                                console.log(`Date alternative trouv√©e dans ${field}:`, manifest[field]);
                                date = manifest[field];
                                break;
                            }
                        }
                    }
                } else {
                    console.log(`Pas de m√©tadonn√©es ou m√©tadonn√©es invalides pour ${arkId}`);
                }
                
                // Si toujours pas de date, essayer la navDate
                if (!date && manifest.navDate) {
                    date = manifest.navDate;
                    console.log(`Date r√©cup√©r√©e depuis navDate:`, date);
                }
                
                console.log(`M√©tadonn√©es finales pour ${arkId}:`, { title, gallicaUrl, date, attribution });
                
                return {
                    title: title,
                    attribution: attribution,
                    gallicaUrl: gallicaUrl,
                    date: date,
                    manifestUrl: manifestUrl
                };
                
            } catch (error) {
                console.warn(`Impossible de r√©cup√©rer les m√©tadonn√©es pour ${arkId}:`, error);
                return {
                    title: `Carte ${arkId}`,
                    attribution: 'Biblioth√®que nationale de France',
                    gallicaUrl: `https://gallica.bnf.fr/ark:/12148/${arkId}`,
                    date: '',
                    manifestUrl: null
                };
            }
        }
        
        // Fonction pour g√©n√©rer une carte avec les vraies donn√©es
        async function generateRealMapCard(mapData) {
            const metadata = await fetchGallicaMetadata(mapData.ark);
            const thumbnailUrl = generateGallicaThumbnail(mapData.ark);
            const gallicaUrl = metadata.gallicaUrl || generateGallicaUrl(mapData.ark);
            const georefUrl = generateGeoreferenceUrl(mapData.ark);
            
            return `
                <div class="fr-col-md-4 fr-col">
                    <div class="fr-card map-card" data-ark-id="${mapData.ark}" data-date="${metadata.date}" onclick="handleCardClick(event, '${mapData.ark}')">
                        <div class="selection-checkbox">
                            <input type="checkbox" 
                                   id="card-${mapData.ark}" 
                                   class="fr-checkbox-input" 
                                   data-ark-id="${mapData.ark}"
                                   onchange="toggleMapSelection('${mapData.ark}', this.closest('.map-card'))">
                            <label for="card-${mapData.ark}" class="fr-checkbox-label"></label>
                        </div>
                        <div class="fr-card__body">
                            <div class="fr-card__content">
                                <h4 class="fr-card__title">
                                    <a href="${gallicaUrl}" target="_blank" rel="noopener">${metadata.title}</a>
                                </h4>
                                <p class="fr-card__desc">${metadata.attribution}${metadata.date ? ` - ${metadata.date}` : ''}</p>
                                <p class="fr-card__desc">
                                    <a href="${gallicaUrl}" target="_blank" rel="noopener">Voir la notice Gallica</a>
                                </p>
                                <p class="fr-card__desc">
                                    <a href="${georefUrl}" target="_blank" rel="noopener">Voir le g√©or√©f√©rencement</a>
                                </p>
                                <div class="fr-card__start">
                                    <ul class="fr-tags-group">
                                        <li><p class="fr-tag fr-tag--green-emeraude">G√©or√©f√©renc√©e</p></li>
                                        <li><p class="fr-tag fr-tag--blue-france">Galligeo</p></li>
                                        ${metadata.date ? `<li><p class="fr-tag fr-tag--yellow-tournesol">${metadata.date}</p></li>` : ''}
                                    </ul>
                                    <p class="fr-card__detail fr-icon-map-pin-2-fill">G√©or√©f√©renc√© par ${mapData.georeferenced_by}</p>
                                    <p class="fr-card__detail fr-icon-calendar-line">${new Date(mapData.georeferenced_date).toLocaleDateString('fr-FR')}</p>
                                </div>
                            </div>
                        </div>
                        <div class="fr-card__header">
                            <div class="fr-card__img">
                                <img class="fr-responsive-img" 
                                     src="${thumbnailUrl}" 
                                     alt="${metadata.title}"
                                     onerror="this.parentElement.style.display='none';" />
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Fonction pour g√©n√©rer une ligne de tableau avec les vraies donn√©es
        async function generateRealTableRow(mapData) {
            const metadata = await fetchGallicaMetadata(mapData.ark);
            const gallicaUrl = metadata.gallicaUrl || generateGallicaUrl(mapData.ark);
            const georefUrl = generateGeoreferenceUrl(mapData.ark);
            
            return `
                <tr class="table-row" data-ark-id="${mapData.ark}" data-date="${metadata.date}" onclick="handleRowClick(event, '${mapData.ark}')">
                    <td>
                        <input type="checkbox" 
                               id="table-${mapData.ark}" 
                               class="fr-checkbox-input" 
                               data-ark-id="${mapData.ark}"
                               onchange="toggleMapSelection('${mapData.ark}', this.closest('.table-row'))">
                        <label for="table-${mapData.ark}" class="fr-checkbox-label">${metadata.title}</label>
                    </td>
                    <td>${metadata.attribution}</td>
                    <td>${metadata.date || 'Non renseign√©e'}</td>
                    <td>${mapData.georeferenced_by}</td>
                    <td>${new Date(mapData.georeferenced_date).toLocaleDateString('fr-FR')}</td>
                    <td>
                        <a href="${gallicaUrl}" target="_blank" rel="noopener" class="fr-btn fr-btn--sm fr-btn--secondary fr-mr-1w">
                            Gallica
                        </a>
                        <a href="${georefUrl}" target="_blank" rel="noopener" class="fr-btn fr-btn--sm fr-btn--primary">
                            G√©or√©f
                        </a>
                    </td>
                </tr>
            `;
        }
        
        // Fonction pour charger le contenu r√©el depuis l'API
        async function loadRealContent() {
            console.log('Chargement du contenu r√©el...');
            
            try {
                // Afficher un indicateur de chargement
                const cardsGrid = document.getElementById('cards-grid');
                const tableBody = document.getElementById('table-body');
                
                if (cardsGrid) {
                    cardsGrid.innerHTML = `
                        <div class="fr-col-12">
                            <div class="fr-card fr-card--no-border">
                                <div class="fr-card__body">
                                    <div class="fr-card__content">
                                        <p class="fr-text--lg">
                                            <span class="fr-icon-loader-line fr-mr-2w" aria-hidden="true"></span>
                                            Chargement des cartes g√©or√©f√©renc√©es...
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                // R√©cup√©rer les donn√©es de l'API
                const apiResult = await fetchGeoreferencedMaps();
                
                if (!apiResult.success) {
                    throw new Error(apiResult.error);
                }
                
                // G√©n√©rer les cartes et lignes de tableau
                console.log('G√©n√©ration du contenu pour', realMapsData.length, 'cartes...');
                
                const cardsPromises = realMapsData.map(mapData => generateRealMapCard(mapData));
                const rowsPromises = realMapsData.map(mapData => generateRealTableRow(mapData));
                
                console.log('Attente de la g√©n√©ration des cartes et lignes...');
                const [cardsHTML, rowsHTML] = await Promise.all([
                    Promise.all(cardsPromises),
                    Promise.all(rowsPromises)
                ]);
                
                console.log('HTML g√©n√©r√© - Cartes:', cardsHTML.length, 'Lignes:', rowsHTML.length);
                
                // Mettre √† jour l'affichage
                if (cardsGrid) {
                    cardsGrid.innerHTML = cardsHTML.join('');
                    console.log('Cartes ins√©r√©es dans le DOM. Contenu:', cardsGrid.innerHTML.length > 100 ? 'OK' : 'VIDE');
                    
                    // Sauvegarder imm√©diatement le contenu des cartes
                    cardsHTMLContent = cardsGrid.innerHTML;
                    console.log('Contenu cartes sauvegard√© automatiquement');
                } else {
                    console.error('cards-grid non trouv√©');
                }
                
                if (tableBody) {
                    tableBody.innerHTML = rowsHTML.join('');
                    console.log('Lignes ins√©r√©es dans le DOM. Contenu:', tableBody.innerHTML.length > 100 ? 'OK' : 'VIDE');
                    
                    // Sauvegarder imm√©diatement le contenu du tableau
                    tableHTMLContent = tableBody.innerHTML;
                    console.log('Contenu tableau sauvegard√© automatiquement');
                } else {
                    console.error('table-body non trouv√©');
                }
                
                // Mettre √† jour les statistiques avec les vraies donn√©es
                const stats = apiResult.stats;
                const totalCount = document.getElementById('total-count');
                if (totalCount) {
                    totalCount.innerHTML = `
                        <span class="fr-icon-map-2-fill" aria-hidden="true"></span>
                        ${stats.total_georeferenced_maps}
                    `;
                }
                
                const contributorsCount = document.getElementById('contributors-count');
                if (contributorsCount) {
                    contributorsCount.innerHTML = `
                        <span class="fr-icon-account-circle-fill" aria-hidden="true"></span>
                        ${stats.total_users_with_georeferenced_maps}
                    `;
                }
                
                const recentCount = document.getElementById('recent-count');
                if (recentCount) {
                    const oneMonthAgo = new Date(Date.now() - 30*24*60*60*1000);
                    const recentMaps = realMapsData.filter(m => new Date(m.georeferenced_date) > oneMonthAgo);
                    recentCount.innerHTML = `
                        <span class="fr-icon-calendar-fill" aria-hidden="true"></span>
                        ${recentMaps.length}
                    `;
                }
                
                console.log('Contenu r√©el charg√© avec succ√®s');
                
                // V√©rifier le contenu g√©n√©r√©
                console.log('=== V√âRIFICATION DU CONTENU ===');
                console.log('Cartes dans le DOM:', document.querySelectorAll('.map-card').length);
                console.log('Lignes dans le DOM:', document.querySelectorAll('#table-body tr').length);
                
                // R√©initialiser la recherche et le filtrage apr√®s chargement du contenu
                setTimeout(() => {
                    resetElementsCache();  // R√©initialiser les caches
                    updateFilterableElements();
                    console.log('√âl√©ments filtrables mis √† jour apr√®s chargement');
                }, 100);
                
                // Ne plus appeler initializeViewToggle ici pour √©viter la double initialisation
                // L'initialisation est d√©j√† faite dans DOMContentLoaded
                
            } catch (error) {
                console.error('Erreur lors du chargement du contenu r√©el:', error);
                
                // Afficher un message d'erreur
                const cardsGrid = document.getElementById('cards-grid');
                if (cardsGrid) {
                    cardsGrid.innerHTML = `
                        <div class="fr-col-12">
                            <div class="fr-alert fr-alert--error">
                                <p><strong>Erreur de chargement</strong></p>
                                <p>Impossible de charger les cartes g√©or√©f√©renc√©es. Veuillez r√©essayer plus tard.</p>
                                <p class="fr-text--xs">D√©tail : ${error.message}</p>
                            </div>
                        </div>
                    `;
                }
            }
        }

        // === FIN G√âN√âRATION DE CONTENU R√âEL ===

        // === GESTION DES VUES - VERSION SIMPLIFI√âE ===
        
        // Variables globales pour stocker le contenu
        let cardsHTMLContent = '';
        let tableHTMLContent = '';
        let currentView = 'cards';
        
        // Fonction pour forcer la sauvegarde (debug uniquement)
        function forceSaveContent() {
            const cardsGrid = document.getElementById('cards-grid');
            const tableBody = document.getElementById('table-body');
            
            if (cardsGrid && cardsGrid.innerHTML.length > 1000) {
                cardsHTMLContent = cardsGrid.innerHTML;
                console.log('Contenu cartes forc√© sauvegard√©:', cardsHTMLContent.length, 'caract√®res');
            }
            
            if (tableBody && tableBody.innerHTML.length > 100) {
                tableHTMLContent = tableBody.innerHTML;
                console.log('Contenu tableau forc√© sauvegard√©:', tableHTMLContent.length, 'caract√®res');
            }
        }
        
        // Fonction simplifi√©e pour basculer entre vue cartes et tableau
        function switchView(viewMode) {
            console.log('=== SWITCH VIEW ===', viewMode);
            
            const cardsContainer = document.getElementById('cards-container');
            const tableContainer = document.getElementById('table-container');
            const cardsRadio = document.getElementById('view-cards');
            const tableRadio = document.getElementById('view-table');
            
            if (!cardsContainer || !tableContainer) {
                console.error('Conteneurs non trouv√©s');
                return;
            }
            
            // Ne PAS sauvegarder ici - utiliser uniquement le contenu sauvegard√© au chargement
            console.log('Utilisation du contenu sauvegard√© - Cartes:', cardsHTMLContent.length, 'caract√®res');
            console.log('Utilisation du contenu sauvegard√© - Tableau:', tableHTMLContent.length, 'caract√®res');
            
            // Basculer l'affichage
            if (viewMode === 'cards') {
                cardsContainer.classList.remove('hidden');
                tableContainer.classList.add('hidden');
                if (cardsRadio) cardsRadio.checked = true;
                currentView = 'cards';
                console.log('Vue cartes activ√©e');
                
                // Restaurer le contenu des cartes
                const cardsGrid = document.getElementById('cards-grid');
                if (cardsGrid && cardsHTMLContent) {
                    cardsGrid.innerHTML = cardsHTMLContent;
                    console.log('Contenu cartes restaur√© depuis la sauvegarde');
                }
                
            } else if (viewMode === 'table') {
                cardsContainer.classList.add('hidden');
                tableContainer.classList.remove('hidden');
                if (tableRadio) tableRadio.checked = true;
                currentView = 'table';
                console.log('Vue tableau activ√©e');
                
                // Restaurer le contenu du tableau
                const tableBody = document.getElementById('table-body');
                if (tableBody && tableHTMLContent) {
                    tableBody.innerHTML = tableHTMLContent;
                    console.log('Contenu tableau restaur√© depuis la sauvegarde');
                }
            }
            
            // V√©rifier le contenu final
            setTimeout(() => {
                const cardsGrid = document.getElementById('cards-grid');
                const tableBody = document.getElementById('table-body');
                console.log('Final - Cartes:', cardsGrid?.innerHTML.length > 1000 ? 'OK' : 'PROBL√àME');
                console.log('Final - Tableau:', tableBody?.innerHTML.length > 200 ? 'OK' : 'PROBL√àME');
            }, 10);
        }

        // Variable pour √©viter la double initialisation
        let viewToggleInitialized = false;

        // √âcouteurs pour les boutons radio de vue
        function initializeViewToggle() {
            if (viewToggleInitialized) {
                console.log('Basculement de vue d√©j√† initialis√©, ignor√©');
                return;
            }
            
            console.log('Initialisation du basculement de vue...');
            
            const cardsRadio = document.getElementById('view-cards');
            const tableRadio = document.getElementById('view-table');
            
            if (!cardsRadio || !tableRadio) {
                console.error('Boutons radio de vue non trouv√©s:', { cardsRadio, tableRadio });
                return;
            }
            
            // Supprimer les anciens √©v√©nements s'ils existent
            cardsRadio.removeEventListener('change', handleCardsChange);
            tableRadio.removeEventListener('change', handleTableChange);
            
            // Ajouter les nouveaux √©v√©nements
            cardsRadio.addEventListener('change', handleCardsChange);
            tableRadio.addEventListener('change', handleTableChange);
            
            // Marquer comme initialis√©
            viewToggleInitialized = true;
            
            console.log('Basculement de vue initialis√©');
        }

        // Gestionnaires d'√©v√©nements s√©par√©s pour √©viter les fuites
        function handleCardsChange(event) {
            if (event.target.checked) {
                console.log('Clic sur vue cartes');
                switchView('cards');
            }
        }

        function handleTableChange(event) {
            if (event.target.checked) {
                console.log('Clic sur vue tableau');
                switchView('table');
            }
        }

        // Fonction globale pour basculer manuellement (debug)
        window.switchToCards = () => switchView('cards');
        window.switchToTable = () => switchView('table');
        
        // Fonctions de debug am√©lior√©es
        window.forceSaveContent = forceSaveContent;
        window.forceRestoreCards = function() {
            const cardsGrid = document.getElementById('cards-grid');
            if (cardsGrid && cardsHTMLContent) {
                cardsGrid.innerHTML = cardsHTMLContent;
                console.log('Contenu cartes forc√©:', cardsHTMLContent.length, 'caract√®res');
            } else {
                console.log('Pas de contenu cartes sauvegard√© ou cardsGrid manquant');
            }
        };
        window.forceRestoreTable = function() {
            const tableBody = document.getElementById('table-body');
            if (tableBody && tableHTMLContent) {
                tableBody.innerHTML = tableHTMLContent;
                console.log('Contenu tableau forc√©:', tableHTMLContent.length, 'caract√®res');
            } else {
                console.log('Pas de contenu tableau sauvegard√© ou tableBody manquant');
            }
        };
        
        // Fonction de diagnostic
        window.debugViews = function() {
            console.log('=== DIAGNOSTIC DES VUES ===');
            const cardsContainer = document.getElementById('cards-container');
            const tableContainer = document.getElementById('table-container');
            const cardsGrid = document.getElementById('cards-grid');
            const tableBody = document.getElementById('table-body');
            
            console.log('Cards container:', cardsContainer ? 'OK' : 'MANQUANT');
            console.log('Table container:', tableContainer ? 'OK' : 'MANQUANT');
            console.log('Cards grid:', cardsGrid ? 'OK' : 'MANQUANT');
            console.log('Table body:', tableBody ? 'OK' : 'MANQUANT');
            
            if (cardsContainer) {
                console.log('Cards visible:', !cardsContainer.classList.contains('hidden'));
                console.log('Cards contenu DOM:', cardsContainer.innerHTML.length > 100 ? 'OK' : 'VIDE');
            }
            
            if (tableContainer) {
                console.log('Table visible:', !tableContainer.classList.contains('hidden'));
                console.log('Table contenu DOM:', tableContainer.innerHTML.length > 100 ? 'OK' : 'VIDE');
            }
            
            console.log('Cartes dans DOM:', document.querySelectorAll('.map-card').length);
            console.log('Lignes dans DOM:', document.querySelectorAll('#table-body tr').length);
            console.log('Donn√©es r√©elles:', window.realMapsData ? window.realMapsData.length : 'NON CHARG√âES');
            console.log('Contenu sauvegard√© - Cartes:', cardsHTMLContent.length, 'caract√®res');
            console.log('Contenu sauvegard√© - Tableau:', tableHTMLContent.length, 'caract√®res');
            console.log('Vue actuelle:', currentView);
        };
        
        // Exposer les donn√©es pour debug
        window.realMapsData = realMapsData;
        window.cardsHTMLContent = () => cardsHTMLContent;
        window.tableHTMLContent = () => tableHTMLContent;

        // === FIN GESTION DES VUES ===

        // === FONCTIONS DE RECHERCHE ET FILTRAGE ===

        // Variable pour stocker tous les √©l√©ments filtrables
        let allFilterableElements = [];
        let allCardsElements = [];  // Cache permanent pour les cartes
        let allTableRowsElements = [];  // Cache permanent pour les lignes

        // Fonction pour r√©initialiser les caches d'√©l√©ments
        function resetElementsCache() {
            console.log('üîÑ R√©initialisation des caches d\'√©l√©ments');
            allCardsElements = [];
            allTableRowsElements = [];
            allFilterableElements = [];
        }
        function initializeSearchAndFilter() {
            console.log('üîç === INITIALISATION RECHERCHE ET FILTRAGE ===');
            
            // Initialiser les √©v√©nements
            const searchInput = document.getElementById('search-input');
            const periodFilter = document.getElementById('period-filter');
            
            console.log('Elements trouv√©s:');
            console.log('- searchInput:', searchInput ? 'OK' : 'MANQUANT');
            console.log('- periodFilter:', periodFilter ? 'OK' : 'MANQUANT');
            
            if (searchInput) {
                console.log('Ajout des √©v√©nements sur searchInput');
                searchInput.addEventListener('input', function(e) {
                    console.log('üîç √âv√©nement input d√©clench√©, valeur:', e.target.value);
                    applySearchAndFilter();
                });
                searchInput.addEventListener('keypress', function(e) {
                    console.log('üîç √âv√©nement keypress d√©clench√©, key:', e.key);
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        applySearchAndFilter();
                    }
                });
                console.log('√âv√©nements search ajout√©s avec succ√®s');
            } else {
                console.error('‚ùå search-input non trouv√© dans le DOM');
            }
            
            if (periodFilter) {
                console.log('Ajout des √©v√©nements sur periodFilter');
                periodFilter.addEventListener('change', function(e) {
                    console.log('üìÖ √âv√©nement change d√©clench√©, valeur:', e.target.value);
                    applySearchAndFilter();
                });
                console.log('√âv√©nements filter ajout√©s avec succ√®s');
            } else {
                console.error('‚ùå period-filter non trouv√© dans le DOM');
            }

            // Mettre √† jour la liste des √©l√©ments filtrables
            updateFilterableElements();
            console.log('üîç Initialisation termin√©e');
        }

        // Fonction pour mettre √† jour la liste des √©l√©ments filtrables
        function updateFilterableElements() {
            console.log('üìã === MISE √Ä JOUR √âL√âMENTS FILTRABLES ===');
            console.log('Vue actuelle:', currentView);
            
            // Toujours r√©cup√©rer les √©l√©ments depuis le DOM (pas de cache)
            if (currentView === 'cards') {
                allFilterableElements = Array.from(document.querySelectorAll('.map-card'));
                console.log('Mode cartes - √âl√©ments trouv√©s dans DOM:', allFilterableElements.length);
            } else {
                allFilterableElements = Array.from(document.querySelectorAll('#table-body tr.table-row'));
                console.log('Mode tableau - √âl√©ments trouv√©s dans DOM:', allFilterableElements.length);
            }
            
            console.log('√âl√©ments filtrables mis √† jour:', allFilterableElements.length);
            
            // V√©rifier quelques √©l√©ments
            if (allFilterableElements.length > 0) {
                console.log('Premier √©l√©ment:', allFilterableElements[0]);
                console.log('data-date du premier:', allFilterableElements[0].getAttribute('data-date'));
            } else {
                console.warn('‚ö†Ô∏è Aucun √©l√©ment filtrable trouv√© !');
                
                // Debug : v√©rifier ce qui existe dans le DOM
                const allCards = document.querySelectorAll('.map-card');
                const allRows = document.querySelectorAll('#table-body tr.table-row');
                const allTableRows = document.querySelectorAll('#table-body tr');
                
                console.log('Debug DOM:');
                console.log('- .map-card:', allCards.length);
                console.log('- #table-body tr.table-row:', allRows.length);
                console.log('- #table-body tr (tous):', allTableRows.length);
            }
        }

        // Fonction de recherche
        function performSearch() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
            console.log('Recherche pour:', searchTerm);

            updateFilterableElements();

            allFilterableElements.forEach(element => {
                let searchableText = '';
                
                if (currentView === 'cards') {
                    // Pour les cartes, chercher dans le titre et la description
                    const title = element.querySelector('.fr-card__title')?.textContent || '';
                    const desc = element.querySelector('.fr-card__desc')?.textContent || '';
                    searchableText = (title + ' ' + desc).toLowerCase();
                } else {
                    // Pour le tableau, chercher dans toutes les cellules
                    const cells = element.querySelectorAll('td');
                    searchableText = Array.from(cells).map(cell => cell.textContent || '').join(' ').toLowerCase();
                }

                if (searchTerm === '' || searchableText.includes(searchTerm)) {
                    element.style.display = '';
                } else {
                    element.style.display = 'none';
                }
            });

            updateVisibleCount();
        }

        // Fonction de filtrage par p√©riode
        function performFilter() {
            const selectedPeriod = document.getElementById('period-filter').value;
            console.log('Filtrage par p√©riode:', selectedPeriod);

            updateFilterableElements();

            allFilterableElements.forEach(element => {
                const dateStr = element.getAttribute('data-date');
                let showElement = true;

                if (selectedPeriod !== 'all' && dateStr && dateStr !== '' && dateStr !== 'undefined') {
                    const year = parseInt(dateStr);
                    
                    switch(selectedPeriod) {
                        case 'before-1800':
                            showElement = year < 1800;
                            break;
                        case '1800-1850':
                            showElement = year >= 1800 && year <= 1850;
                            break;
                        case '1850-1900':
                            showElement = year >= 1850 && year <= 1900;
                            break;
                        case '1900-1950':
                            showElement = year >= 1900 && year <= 1950;
                            break;
                        case 'after-1950':
                            showElement = year > 1950;
                            break;
                        default:
                            showElement = true;
                    }
                }

                if (showElement) {
                    element.style.display = '';
                } else {
                    element.style.display = 'none';
                }
            });

            updateVisibleCount();
        }

        // Fonction pour combiner recherche et filtrage
        function applySearchAndFilter() {
            console.log('üéØ === APPLICATION RECHERCHE ET FILTRAGE ===');
            
            const searchInput = document.getElementById('search-input');
            const periodFilter = document.getElementById('period-filter');
            
            const searchTerm = searchInput ? searchInput.value.toLowerCase().trim() : '';
            const selectedPeriod = periodFilter ? periodFilter.value : 'all';
            
            console.log('Param√®tres:');
            console.log('- Terme recherche:', `"${searchTerm}"`);
            console.log('- P√©riode s√©lectionn√©e:', selectedPeriod);

            // FORCER LA R√âAFFICHAGE DE TOUS LES √âL√âMENTS EN PREMIER
            console.log('üîÑ R√âAFFICHAGE FORC√â DE TOUS LES √âL√âMENTS');
            const allCardsInDOM = document.querySelectorAll('.map-card');
            const allRowsInDOM = document.querySelectorAll('#table-body tr.table-row');
            
            // Forcer l'affichage de TOUS les √©l√©ments
            allCardsInDOM.forEach((card, i) => {
                card.style.display = '';
                console.log(`Carte ${i} r√©affich√©e`);
            });
            allRowsInDOM.forEach((row, i) => {
                row.style.display = '';
                console.log(`Ligne ${i} r√©affich√©e`);
            });
            
            console.log(`Total r√©affich√©s: ${allCardsInDOM.length} cartes, ${allRowsInDOM.length} lignes`);

            // Maintenant mettre √† jour les √©l√©ments filtrables avec les √©l√©ments fra√Æchement r√©affich√©s
            if (currentView === 'cards') {
                allFilterableElements = Array.from(allCardsInDOM);
            } else {
                allFilterableElements = Array.from(allRowsInDOM);
            }
            
            console.log('√âl√©ments filtrables actualis√©s:', allFilterableElements.length);

            let visibleCount = 0;
            let hiddenCount = 0;

            // Appliquer les filtres
            allFilterableElements.forEach((element, index) => {
                let searchableText = '';
                let showElement = true;

                // Test de recherche textuelle
                if (searchTerm !== '') {
                    if (currentView === 'cards') {
                        const titleEl = element.querySelector('.fr-card__title');
                        const descEl = element.querySelector('.fr-card__desc');
                        const title = titleEl ? titleEl.textContent || '' : '';
                        const desc = descEl ? descEl.textContent || '' : '';
                        searchableText = (title + ' ' + desc).toLowerCase();
                        
                        if (index < 3) {
                            console.log(`Carte ${index} - Titre:`, title);
                            console.log(`Carte ${index} - Desc:`, desc);
                            console.log(`Carte ${index} - Texte recherchable:`, searchableText);
                        }
                    } else {
                        const cells = element.querySelectorAll('td');
                        searchableText = Array.from(cells).map(cell => cell.textContent || '').join(' ').toLowerCase();
                        
                        if (index < 3) {
                            console.log(`Ligne ${index} - Texte recherchable:`, searchableText);
                        }
                    }
                    
                    if (!searchableText.includes(searchTerm)) {
                        showElement = false;
                        if (index < 3) console.log(`√âl√©ment ${index} masqu√© par recherche - recherch√©: "${searchTerm}", trouv√©: "${searchableText.substring(0, 100)}"`);
                    } else {
                        if (index < 3) console.log(`√âl√©ment ${index} CORRESPOND √† la recherche "${searchTerm}"`);
                    }
                }

                // Test de filtrage par p√©riode
                if (showElement && selectedPeriod !== 'all') {
                    const dateStr = element.getAttribute('data-date');
                    if (index < 3) console.log(`√âl√©ment ${index} - data-date:`, dateStr);
                    
                    if (dateStr && dateStr !== '' && dateStr !== 'undefined') {
                        const year = parseInt(dateStr);
                        if (index < 3) console.log(`Ann√©e pars√©e: ${year} pour p√©riode ${selectedPeriod}`);
                        
                        switch(selectedPeriod) {
                            case 'before-1800':
                                showElement = year < 1800;
                                break;
                            case '1800-1850':
                                showElement = year >= 1800 && year <= 1850;
                                break;
                            case '1850-1900':
                                showElement = year >= 1850 && year <= 1900;
                                break;
                            case '1900-1950':
                                showElement = year >= 1900 && year <= 1950;
                                break;
                            case 'after-1950':
                                showElement = year > 1950;
                                break;
                        }
                        
                        if (!showElement && index < 3) {
                            console.log(`√âl√©ment ${index} masqu√© par p√©riode: ${year} ne correspond pas √† ${selectedPeriod}`);
                        }
                    } else {
                        if (index < 3) console.log(`√âl√©ment ${index} - pas de date valide:`, dateStr);
                    }
                }

                // Appliquer l'affichage final
                if (showElement) {
                    element.style.display = '';
                    visibleCount++;
                } else {
                    element.style.display = 'none';
                    hiddenCount++;
                }
            });

            console.log(`R√©sultats finaux: ${visibleCount} visibles, ${hiddenCount} masqu√©s`);
            updateVisibleCount();
        }

        // Fonction pour mettre √† jour le compteur d'√©l√©ments visibles
        function updateVisibleCount() {
            updateFilterableElements();
            const visibleElements = allFilterableElements.filter(el => el.style.display !== 'none');
            console.log('√âl√©ments visibles:', visibleElements.length, 'sur', allFilterableElements.length);
        }

        // Modifier les fonctions de changement de vue pour r√©initialiser les filtres
        const originalSwitchView = switchView;
        switchView = function(view) {
            console.log('üîÑ switchView appel√©e avec vue:', view);
            originalSwitchView(view);
            
            // R√©appliquer les filtres apr√®s changement de vue
            setTimeout(() => {
                console.log('üîÑ R√©application des filtres apr√®s changement de vue');
                
                // Forcer le r√©affichage de tous les √©l√©ments dans toutes les vues
                const allCards = document.querySelectorAll('.map-card');
                const allRows = document.querySelectorAll('#table-body tr.table-row');
                allCards.forEach(card => card.style.display = '');
                allRows.forEach(row => row.style.display = '');
                console.log('üîÑ Tous les √©l√©ments r√©affich√©s avant r√©application');
                
                applySearchAndFilter();
            }, 200);  // D√©lai plus long pour s'assurer que le DOM est stable
        };

        // === FIN FONCTIONS DE RECHERCHE ET FILTRAGE ===

        // === FONCTIONS DE DEBUG ===
        
        // Fonction de test pour v√©rifier la recherche et le filtrage
        window.testSearchAndFilter = function() {
            console.log('üß™ === TEST RECHERCHE ET FILTRAGE ===');
            
            // V√©rifier les √©l√©ments DOM
            const searchInput = document.getElementById('search-input');
            const periodFilter = document.getElementById('period-filter');
            
            console.log('√âl√©ments DOM:');
            console.log('- search-input:', searchInput);
            console.log('- period-filter:', periodFilter);
            
            if (searchInput) {
                console.log('- search-input value:', searchInput.value);
                console.log('- search-input listeners:', getEventListeners ? getEventListeners(searchInput) : 'N/A');
            }
            
            if (periodFilter) {
                console.log('- period-filter value:', periodFilter.value);
                console.log('- period-filter options:', Array.from(periodFilter.options).map(o => o.value));
            }
            
            // V√©rifier les √©l√©ments filtrables
            updateFilterableElements();
            
            // Test de recherche manuel
            console.log('Test de recherche avec "paris":');
            if (searchInput) {
                searchInput.value = 'paris';
                applySearchAndFilter();
            }
        };
        
        // Fonction pour forcer la r√©initialisation
        window.forceReinitializeSearch = function() {
            console.log('üîß === R√âINITIALISATION FORC√âE ===');
            resetElementsCache();
            initializeSearchAndFilter();
        };
        
        // Fonction pour r√©initialiser l'affichage (montrer tous les √©l√©ments)
        window.resetDisplay = function() {
            console.log('üîÑ === R√âINITIALISATION AFFICHAGE ===');
            
            // Remettre √† vide les champs
            const searchInput = document.getElementById('search-input');
            const periodFilter = document.getElementById('period-filter');
            
            if (searchInput) searchInput.value = '';
            if (periodFilter) periodFilter.value = 'all';
            
            // Afficher tous les √©l√©ments
            const allCards = document.querySelectorAll('.map-card');
            const allRows = document.querySelectorAll('#table-body tr.table-row');
            
            allCards.forEach(card => card.style.display = '');
            allRows.forEach(row => row.style.display = '');
            
            console.log('Affichage r√©initialis√© - Cartes:', allCards.length, 'Lignes:', allRows.length);
        };
        
        // Fonction pour d√©bugger l'√©tat de l'affichage
        window.debugDisplay = function() {
            console.log('üîç === DEBUG AFFICHAGE ===');
            
            const allCards = document.querySelectorAll('.map-card');
            const allRows = document.querySelectorAll('#table-body tr.table-row');
            
            console.log('Vue actuelle:', currentView);
            console.log('Total cartes dans DOM:', allCards.length);
            console.log('Total lignes dans DOM:', allRows.length);
            
            let visibleCards = 0, hiddenCards = 0;
            let visibleRows = 0, hiddenRows = 0;
            
            allCards.forEach(card => {
                if (card.style.display === 'none') hiddenCards++;
                else visibleCards++;
            });
            
            allRows.forEach(row => {
                if (row.style.display === 'none') hiddenRows++;
                else visibleRows++;
            });
            
            console.log('Cartes - Visibles:', visibleCards, 'Masqu√©es:', hiddenCards);
            console.log('Lignes - Visibles:', visibleRows, 'Masqu√©es:', hiddenRows);
            
            // √âtat des champs
            const searchInput = document.getElementById('search-input');
            const periodFilter = document.getElementById('period-filter');
            console.log('Recherche:', searchInput ? searchInput.value : 'N/A');
            console.log('P√©riode:', periodFilter ? periodFilter.value : 'N/A');
        };
        
        // Fonction pour forcer l'affichage de tous les √©l√©ments
        window.forceShowAll = function() {
            console.log('üí™ === FOR√áAGE AFFICHAGE TOUS LES √âL√âMENTS ===');
            
            const allCards = document.querySelectorAll('.map-card');
            const allRows = document.querySelectorAll('#table-body tr.table-row');
            
            allCards.forEach((card, i) => {
                card.style.display = '';
                card.style.visibility = 'visible';
                card.style.opacity = '1';
                console.log(`Carte ${i} forc√©e visible`);
            });
            
            allRows.forEach((row, i) => {
                row.style.display = '';
                row.style.visibility = 'visible';
                row.style.opacity = '1';
                console.log(`Ligne ${i} forc√©e visible`);
            });
            
            console.log(`Tous les √©l√©ments forc√©s visibles: ${allCards.length} cartes, ${allRows.length} lignes`);
        };
        
        // === FIN FONCTIONS DE DEBUG ===

        // Fonction pour v√©rifier l'√©tat d'authentification
        async function checkAuthenticationStatus() {
            try {
                // V√©rifier si l'utilisateur revient d'une authentification (token dans l'URL)
                const urlParams = new URLSearchParams(window.location.search);
                const token = urlParams.get('token') || urlParams.get('access_token');
                
                if (token) {
                    console.log('Token d√©tect√© dans l\'URL, configuration de l\'authentification...');
                    window.ptmAuth.setToken(token);
                    
                    // Nettoyer l'URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
                
                const isAuthenticated = await window.ptmAuth.checkAuthStatus();
                updateAuthenticationUI(isAuthenticated);
                
            } catch (error) {
                console.error('Erreur lors de la v√©rification de l\'authentification:', error);
                updateAuthenticationUI(false);
            }
        }

        // Fonction pour mettre √† jour l'interface utilisateur selon l'√©tat d'authentification
        function updateAuthenticationUI(isAuthenticated) {
            const authContainer = document.getElementById('auth-button-container');
            
            if (isAuthenticated && authContainer) {
                // Remplacer le bouton de connexion par les informations utilisateur
                window.ptmAuth.getUserProfile().then(userProfile => {
                    authContainer.innerHTML = `
                        <div class="user-menu-container">
                            <span class="fr-text--sm">
                                <span class="fr-icon-account-circle-line fr-mr-1w" aria-hidden="true"></span>
                                ${userProfile.first_name} ${userProfile.last_name}
                            </span>
                            <button class="fr-btn fr-btn--sm fr-btn--secondary fr-ml-2w" onclick="window.ptmAuth.logout()">
                                D√©connexion
                            </button>
                        </div>
                    `;
                });
            }
        }

        // Fonction pour initialiser l'affichage de version
        function initializeVersionDisplay() {
            const versionDisplay = document.getElementById('version-display');
            
            if (!versionDisplay) return;
            
            // Attendre que les informations de version soient disponibles
            function updateVersionInfo() {
                if (window.APP_VERSION) {
                    const version = window.APP_VERSION;
                    versionDisplay.textContent = version.shortDisplayVersion;
                } else {
                    // R√©essayer dans 100ms si les informations ne sont pas encore disponibles
                    setTimeout(updateVersionInfo, 100);
                }
            }
            
            updateVersionInfo();
        }
    </script>

    <!-- Matomo -->
    <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
        var u="//ptm.huma-num.fr/matomo/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '23']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
    </script>
    <!-- End Matomo Code -->

  </body>
</html>